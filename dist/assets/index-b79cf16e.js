import{e as h,a as ae}from"./index-50631119.js";/* empty css               *//* empty css                  */import{_ as le}from"./TableModel.vuevuetypescriptsetuptruenameTableModellang-eb1352c5.js";import{u as oe,a as ne,b as M}from"./useColumn-3a58f8fd.js";import{h as P,d as z,b as m,r as f,D as E,E as $,V as o,u as t,f as x,F as w,Y as s,a0 as g,W as se,ah as re,Z as ue,t as ie}from"./vue-bfef4675.js";import{S as de}from"./SearchModel-2c89adf6.js";import{G as ce,B as me,y as pe,z as fe,H as ge,I as _e,J as be,K as ve,C as he,L as Ve}from"./element-plus-3a9b3aba.js";import"./vue-i18n-81613396.js";import"./pinia-574b3635.js";import"./vue-router-20616233.js";import"./nprogress-c3ec224b.js";import"./mockjs-de833af9.js";import"./axios-dc3e32a0.js";/* empty css                 *//* empty css            */const{ElInput:A,ElSelect:q}=ne();var v=(n=>(n.ADD="新增",n.UPDATE="编辑",n))(v||{});const ye=[{component:A,label:"姓名",field:"username",placeholder:"请输入"},{component:A,label:"账号",field:"account",placeholder:"请输入"},{component:q,label:"状态",field:"status",clearable:!0,options:[{label:"正常",value:"1"},{label:"禁用",value:"0"}]},{component:q,label:"权限",field:"role",clearable:!0,options:[{label:"用户",value:"1"},{label:"管理员",value:"0"}]}],we=[{fixed:!0,type:"selection",width:"50"},{fixed:!0,prop:"id",label:"编号",width:"70",align:"center"},{prop:"account",label:"账号",width:"180"},{prop:"username",label:"用户名",width:"180"},{prop:"status",label:"状态",width:"80",slot:({row:n})=>[P("span",n.status==="1"?"正常":"禁用")]},{prop:"roles",label:"权限",slot:({row:n})=>n.roles?n==null?void 0:n.roles.map(D=>oe(D.name||"",()=>{},{style:{margin:"2px"}})):[P("span")]}],De=n=>h.POST({url:"/admin/user/index",useMock:!1,data:n}),ke=n=>h.POST({url:"/admin/user/create",useMock:!1,data:n}),Ce=n=>h.POST({url:"/admin/user/modify",useMock:!1,data:n}),Se=n=>h.POST({url:"/admin/user/delete",useMock:!1,data:{ids:n}}),Ue=()=>h.POST({url:"/admin/role/list",useMock:!1}),Ee={"page-card":""},xe={flex:"",items:"center"},Re=w("div",{"i-ri-add-fill":"","mr-1":""},null,-1),Te=w("div",{"i-ri-delete-bin-line":"","mr-1":""},null,-1),Fe={class:"dialog-footer"},Oe=z({name:"User"}),Ye=z({...Oe,setup(n){const D=m(),{$message:p,$msgbox:j}=ae(),R=f([]),_=f({username:"",account:"",status:"",role:""}),k=m(!1),I=m([...we,{fixed:"right",label:"操作",width:"160",slot:({row:a})=>[M("编辑",()=>{K(a)}),M("删除",()=>{F([a])},{type:"danger"})]}]),T=m([]),C=m([]),i=f({page:1,size:10,total:0}),d=m(!1),V=m(v.ADD);function L(){Object.assign(_,{}),c()}function G(a){C.value=a}function N(a){i.page=a,c()}function H(a){i.size=a,c()}function F(a){j.confirm("确认删除选中数据条目吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const e=[];a.forEach(u=>{e.push(u.id)}),Se(e).then(()=>{p.success("删除成功！"),c()}).catch(u=>{p.warning(u)})})}function c(){k.value=!0,setTimeout(async()=>{const{data:a,meta:e}=await De({query:_,...i});i.page=e.pagination.current_page,i.size=e.pagination.per_page,i.total=e.pagination.count,k.value=!1,T.value=a},300)}const r=f({id:"",account:"",username:"",avatar:"",password:null,status:1,roles:[],created_at:""});async function J(){await O(),Object.assign(r,{}),V.value=v.ADD,d.value=!0}async function K(a){await O(),V.value=v.UPDATE;const e=f(ce(ie(a)));e.roles=a.roles.map(u=>u.id),Object.assign(r,e),d.value=!0}const Q=f({username:[{required:!0,message:"请输入用户名",trigger:"blur"}],account:[{required:!0,message:"请输入账号",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}],roles:[{required:!0,message:"请选择角色",trigger:"change"}]}),S=m();function W(){var a;(a=S.value)==null||a.validate(e=>{e?V.value===v.ADD?ke(r).then(()=>{d.value=!1,p.success("保存成功！"),c()}).catch(u=>{p.warning(u)}):Ce(r).then(()=>{d.value=!1,p.success("保存成功！"),c()}).catch(u=>{p.warning(u)}):p.warning("请完善必填选项！")})}async function O(){const{data:a}=await Ue();Object.assign(R,a)}return c(),(a,e)=>{const u=me,U=pe,b=fe,Y=ge,Z=_e,B=be,X=ve,ee=he,te=Ve;return E(),$("div",Ee,[o(t(de),{modelValue:t(_),"onUpdate:modelValue":e[0]||(e[0]=l=>x(_)?_.value=l:null),config:t(ye),"per-line-count":4,onQuery:c,onReset:L},null,8,["modelValue","config"]),w("div",xe,[o(u,{type:"primary",onClick:J},{default:s(()=>[Re,g(" 新增 ")]),_:1}),o(u,{type:"danger",disabled:!t(C).length,onClick:e[1]||(e[1]=l=>F(t(C)))},{default:s(()=>[Te,g(" 删除 ")]),_:1},8,["disabled"])]),o(t(le),{ref_key:"tableModelRef",ref:D,pagination:t(i),"onUpdate:pagination":e[2]||(e[2]=l=>x(i)?i.value=l:null),loading:t(k),columns:t(I),data:t(T),"row-key":"id",onSelectionChange:G,onPageChange:N,onSizeChange:H},null,8,["pagination","loading","columns","data"]),o(te,{modelValue:t(d),"onUpdate:modelValue":e[9]||(e[9]=l=>x(d)?d.value=l:null),width:600,title:t(V),"show-close":!1,"close-on-click-modal":!1,onClosed:e[10]||(e[10]=l=>{var y;return(y=t(S))==null?void 0:y.resetFields()})},{footer:s(()=>[w("span",Fe,[o(u,{onClick:e[8]||(e[8]=l=>d.value=!1)},{default:s(()=>[g("取消")]),_:1}),o(u,{type:"primary",onClick:W},{default:s(()=>[g(" 保存 ")]),_:1})])]),default:s(()=>[o(ee,{ref_key:"submitFormRef",ref:S,model:t(r),rules:t(Q),"label-width":"100px",style:{width:"95%"},"status-icon":""},{default:s(()=>[o(b,{label:"账号",prop:"account"},{default:s(()=>[o(U,{modelValue:t(r).account,"onUpdate:modelValue":e[3]||(e[3]=l=>t(r).account=l),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),o(b,{label:"用户名",prop:"username"},{default:s(()=>[o(U,{modelValue:t(r).username,"onUpdate:modelValue":e[4]||(e[4]=l=>t(r).username=l),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),o(b,{label:"密码",prop:"password"},{default:s(()=>[o(U,{modelValue:t(r).password,"onUpdate:modelValue":e[5]||(e[5]=l=>t(r).password=l),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),o(b,{label:"角色",prop:"roles"},{default:s(()=>[o(Z,{modelValue:t(r).roles,"onUpdate:modelValue":e[6]||(e[6]=l=>t(r).roles=l),multiple:"",style:{width:"100%"}},{default:s(()=>[(E(!0),$(se,null,re(t(R),(l,y)=>(E(),ue(Y,{key:y,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(b,{label:"状态",prop:"status"},{default:s(()=>[o(X,{modelValue:t(r).status,"onUpdate:modelValue":e[7]||(e[7]=l=>t(r).status=l)},{default:s(()=>[o(B,{label:1,border:""},{default:s(()=>[g(" 正常 ")]),_:1}),o(B,{label:0,border:""},{default:s(()=>[g(" 禁用 ")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});export{Ye as default};
